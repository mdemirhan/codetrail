{
  "name": "codex mixed event forms with non-object fallback",
  "input": {
    "provider": "codex",
    "sessionId": "codex-session-1",
    "payload": [
      {
        "kind": "reasoning",
        "message": "Need to gather context before editing.",
        "created_at": "2026-02-27T11:00:00Z",
        "usage": {
          "input": 40,
          "output": 5
        }
      },
      {
        "kind": "assistant_message",
        "text": "I will run search next.",
        "timestamp": "2026-02-27T11:00:04Z"
      },
      "unexpected raw event line"
    ]
  },
  "expected": {
    "messages": [
      {
        "sessionId": "codex-session-1",
        "provider": "codex",
        "category": "thinking",
        "content": "Need to gather context before editing.",
        "createdAt": "2026-02-27T11:00:00.000Z",
        "tokenInput": 40,
        "tokenOutput": 5
      },
      {
        "sessionId": "codex-session-1",
        "provider": "codex",
        "category": "assistant",
        "content": "I will run search next.",
        "createdAt": "2026-02-27T11:00:04.000Z",
        "tokenInput": null,
        "tokenOutput": null
      },
      {
        "sessionId": "codex-session-1",
        "provider": "codex",
        "category": "system",
        "content": "unexpected raw event line",
        "createdAt": "1970-01-01T00:00:00.000Z",
        "tokenInput": null,
        "tokenOutput": null
      }
    ],
    "diagnostics": [
      {
        "severity": "warning",
        "code": "parser.non_object_event",
        "provider": "codex",
        "sessionId": "codex-session-1",
        "eventIndex": 2,
        "message": "Encountered non-object event; normalized to system message."
      }
    ]
  }
}
